// ==========================================
// ã‚¢ã‚¤ãƒ†ãƒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ (No.200 - No.299)
// ==========================================
const DB_ITEM = {
    // --- å›å¾©ç³» (200-219) ---
    200: { name: "éå¸¸é£Ÿ", rare: "NORMAL", type: "heal_fix", val: 50 },
    201: { name: "å¹²ã—è‚‰", rare: "NORMAL", type: "heal_fix", val: 80 },
    202: { name: "ãŠã«ãã‚Š", rare: "NORMAL", type: "heal_fix", val: 100 },
    203: { name: "ã‚µãƒ³ãƒ‰ã‚¤ãƒƒãƒ", rare: "NORMAL", type: "heal_fix", val: 120 },
    204: { name: "ã‚¨ãƒŠã‚¸ãƒ¼ãƒãƒ¼", rare: "NORMAL", type: "heal_fix", val: 150 },
    205: { name: "ã‚¹ãƒãƒ¼ãƒ„ãƒ‰ãƒªãƒ³ã‚¯", rare: "NORMAL", type: "heal_fix", val: 180 },
    206: { name: "ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ", rare: "NORMAL", type: "heal_fix", val: 200 },
    207: { name: "æ¼¢æ–¹è–¬", rare: "NORMAL", type: "heal_fix", val: 250 },
    208: { name: "ç‰¹è£½ãŠå¼å½“", rare: "NORMAL", type: "heal_fix", val: 300 },
    209: { name: "è¬ã®ã‚­ãƒã‚³", rare: "NORMAL", type: "heal_fix", val: 400 },
    210: { name: "ãƒãƒ¼ã‚·ãƒ§ãƒ³", rare: "ELITE", type: "heal_fix", val: 600 },
    211: { name: "ãƒã‚¤ãƒãƒ¼ã‚·ãƒ§ãƒ³", rare: "ELITE", type: "heal_fix", val: 1000 },
    212: { name: "æ•‘æ€¥ã‚­ãƒƒãƒˆ", rare: "ELITE", type: "heal_fix", val: 1500 },
    213: { name: "ä¸‡èƒ½è–¬", rare: "ELITE", type: "heal_fix", val: 2500 },
    214: { name: "ç™’ã‚„ã—ã®é¦™æ°´", rare: "ELITE", type: "heal_per", val: 0.3 }, // 30%å›å¾©
    215: { name: "ç”Ÿå‘½ã®ç²‰å¡µ", rare: "ELITE", type: "heal_per", val: 0.5 }, // 50%å›å¾©
    216: { name: "ã‚¨ãƒªã‚¯ã‚µãƒ¼", rare: "LEGEND", type: "heal_per", val: 1.0 }, // å…¨å›å¾©
    217: { name: "ä¸æ­»é³¥ã®å°¾", rare: "LEGEND", type: "heal_per", val: 1.0 },
    218: { name: "è–æ°´", rare: "LEGEND", type: "heal_per", val: 1.0 },
    219: { name: "ç¥æ§˜ã®é›«", rare: "LEGEND", type: "heal_per", val: 1.0 },

    // --- æ”»æ’ƒç³» (220-239: ç«/æ°´/é›·/è‰ å„Lv1-5) ---
    220: { name: "ç«ã®ç²‰", rare: "NORMAL", type: "dmg", elem: "ğŸ”¥", val: 50 },
    221: { name: "ç«ç‚ç“¶", rare: "NORMAL", type: "dmg", elem: "ğŸ”¥", val: 100 },
    222: { name: "ç«ç‚æ”¾å°„å™¨", rare: "NORMAL", type: "dmg", elem: "ğŸ”¥", val: 200 },
    223: { name: "ãƒ—ãƒ­ãƒŸãƒãƒ³ã‚¹", rare: "ELITE", type: "dmg", elem: "ğŸ”¥", val: 500 },
    224: { name: "å¤ªé™½ã®è¼ã", rare: "LEGEND", type: "dmg", elem: "ğŸ”¥", val: 1200 },
    225: { name: "æ°´é‰„ç ²", rare: "NORMAL", type: "dmg", elem: "ğŸ’§", val: 50 },
    226: { name: "ã‚¹ãƒ—ãƒªãƒ³ã‚¯ãƒ©ãƒ¼", rare: "NORMAL", type: "dmg", elem: "ğŸ’§", val: 100 },
    227: { name: "æ¿€æµãƒãƒ³ãƒ—", rare: "NORMAL", type: "dmg", elem: "ğŸ’§", val: 200 },
    228: { name: "å¤§ç€‘å¸ƒ", rare: "ELITE", type: "dmg", elem: "ğŸ’§", val: 500 },
    229: { name: "æ°·æ²³ã®ä¸€æ’ƒ", rare: "LEGEND", type: "dmg", elem: "ğŸ’§", val: 1200 },
    230: { name: "é™é›»æ°—ã®å¼¾", rare: "NORMAL", type: "dmg", elem: "âš¡", val: 50 },
    231: { name: "ã‚¹ã‚¿ãƒ³ã‚¬ãƒ³", rare: "NORMAL", type: "dmg", elem: "âš¡", val: 100 },
    232: { name: "ç™ºé›»æ©Ÿ", rare: "NORMAL", type: "dmg", elem: "âš¡", val: 200 },
    233: { name: "è½é›·ã®æ–", rare: "ELITE", type: "dmg", elem: "âš¡", val: 500 },
    234: { name: "ç¥ã®è£ã", rare: "LEGEND", type: "dmg", elem: "âš¡", val: 1200 },
    235: { name: "ãƒˆã‚²ä»˜ãã®ç¨®", rare: "NORMAL", type: "dmg", elem: "ğŸŒ¿", val: 50 },
    236: { name: "å·»ãä»˜ãè”¦", rare: "NORMAL", type: "dmg", elem: "ğŸŒ¿", val: 100 },
    237: { name: "é‹­ã„è‘‰ã£ã±", rare: "NORMAL", type: "dmg", elem: "ğŸŒ¿", val: 200 },
    238: { name: "å¤§æ£®æ—ã®æ€’ã‚Š", rare: "ELITE", type: "dmg", elem: "ğŸŒ¿", val: 500 },
    239: { name: "ä¸–ç•Œæ¨¹ã®å¯©åˆ¤", rare: "LEGEND", type: "dmg", elem: "ğŸŒ¿", val: 1200 },

    // --- ãƒãƒ•ãƒ»ãƒ‡ãƒãƒ•ãƒ»ç‰¹æ®Šç³» (240-279) ---
    240: { name: "ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚¦ã‚¤ãƒ«ã‚¹", rare: "NORMAL", type: "e_debuff", stat: "atk", val: 0.8 },
    250: { name: "ã‚„ã‚‹æ°—æ³¨å…¥å™¨", rare: "NORMAL", type: "p_buff", stat: "atk", val: 1.2 },
    260: { name: "ç…™ç‰", rare: "NORMAL", type: "escape" },
    261: { name: "å¹¸é‹ã®ç£çŸ³", rare: "ELITE", type: "exp_boost" },
    265: { name: "ä¸æ€è­°ãªç ‚æ™‚è¨ˆ", rare: "LEGEND", type: "extra_turn" },
    266: { name: "ç«ã®ãŠå®ˆã‚Š", rare: "ELITE", type: "change_pelem", elem: "ğŸ”¥" },
    267: { name: "æ°´ã®ãŠå®ˆã‚Š", rare: "ELITE", type: "change_pelem", elem: "ğŸ’§" },
    268: { name: "é›·ã®ãŠå®ˆã‚Š", rare: "ELITE", type: "change_pelem", elem: "âš¡" },
    269: { name: "è™¹ã®ã‹ã‘ã‚‰", rare: "LEGEND", type: "auto_weak" },
    270: { name: "ç™ºç«ç‡ƒæ–™", rare: "ELITE", type: "field", elem: "ğŸ”¥" },
    271: { name: "é›¨é›²ç™ºç”Ÿæ©Ÿ", rare: "ELITE", type: "field", elem: "ğŸ’§" },
    272: { name: "ç£å ´ç™ºç”Ÿè£…ç½®", rare: "ELITE", type: "field", elem: "âš¡" },
    273: { name: "è¶…æˆé•·ä¿ƒé€²å‰¤", rare: "ELITE", type: "field", elem: "ğŸŒ¿" },
    274: { name: "æ¯’é‡", rare: "NORMAL", type: "inst_death", rate: 0.1 },
    275: { name: "ã‚®ãƒ£ãƒ³ãƒ–ãƒ«ã®ã‚µã‚¤ã‚³ãƒ­", rare: "ELITE", type: "gamble" },
    276: { name: "ãƒšãƒ³ã‚­", rare: "NORMAL", type: "paint" },
    277: { name: "è¦šæ‚Ÿã®ã‚¹ã‚¹ãƒ¡", rare: "ELITE", type: "atk_focus" },
    278: { name: "äº€ã®ç”²ç¾…", rare: "ELITE", type: "def_focus" },
    279: { name: "ç½ ", rare: "NORMAL", type: "trap" },

    // --- ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç³» (280-297) ---
    280: { name: "å¤ã³ãŸãƒ©ãƒ³ãƒ—", rare: "LEGEND", type: "none" },
    281: { name: "ä½•ã‹ã®ç¥æ§˜ã®åƒ", rare: "LEGEND", type: "none" },
    282: { name: "èª°ã‹ã®æ—¥è¨˜", rare: "LEGEND", type: "none" },
    283: { name: "æµ·è³Šã®éŠ€è²¨", rare: "LEGEND", type: "none" },
    284: { name: "æ›¸ã‘ãªã„ä¸‡å¹´ç­†", rare: "LEGEND", type: "none" },
    285: { name: "æ±æ´‹ã®æ°´å¢¨ç”»", rare: "LEGEND", type: "none" },
    286: { name: "è£¸ã®ç‹æ§˜ã®æœ", rare: "LEGEND", type: "none" },
    287: { name: "ç›¸å¯¾æ€§ç†è«–åŸæœ¬", rare: "LEGEND", type: "none" },
    288: { name: "é™ã‚ŠãªãçœŸå††ã«è¿‘ã„çŸ³", rare: "LEGEND", type: "none" },
    289: { name: "å††å‘¨ç‡æœ€å¾Œã®æ•°å­—", rare: "LEGEND", type: "none" },
    290: { name: "èª°ã‚‚çŸ¥ã‚‰ãªã„ç‰©èª", rare: "LEGEND", type: "none" },
    291: { name: "æ¼¢ã®æµªæ¼«", rare: "LEGEND", type: "none" },
    292: { name: "å¤ä»£ã®ãƒ‡ã‚¸ã‚¿ãƒ«æ™‚è¨ˆ", rare: "LEGEND", type: "none" },
    293: { name: "å½å…¸", rare: "LEGEND", type: "none" },
    294: { name: "ã‚µãƒ³ã‚¿ã®é«­", rare: "LEGEND", type: "none" },
    295: { name: "ã‚µãƒ³ã‚¿ã®é«­ï¼ˆæœ¬ç‰©ï¼‰", rare: "LEGEND", type: "none" },
    296: { name: "å¤©ä½¿ã®è¼ªã£ã‹", rare: "LEGEND", type: "none" },
    297: { name: "ç«œã®ãƒ•ãƒ³", rare: "LEGEND", type: "none" },

    // --- ãƒ©ã‚¹ãƒˆ (298-299) ---
    298: { name: "çŸ³", rare: "NORMAL", type: "stone" },
    299: { name: "è–æ›¸", rare: "LEGEND", type: "bible" }
};

// ==========================================
// ã‚¢ã‚¤ãƒ†ãƒ ä½¿ç”¨å‡¦ç†
// ==========================================
function useItem(id, index) {
    const item = DB_ITEM[id];
    let msg = "";
    let skipEnemyTurn = false;

    switch (item.type) {
        case "heal_fix":
            php = Math.min(pmax, php + item.val);
            msg = `${item.name}ã§HPãŒ ${item.val} å›å¾©ã—ãŸï¼`;
            break;
        case "heal_per":
            let hVal = Math.floor(pmax * item.val);
            php = Math.min(pmax, php + hVal);
            msg = `${item.name}ã§HPãŒå…¨å¿«ã—ãŸï¼`;
            break;
        case "dmg":
            let d = item.val;
            if (ELEMENTS[item.elem] === eelem) d *= 2;
            ehp -= d;
            msg = `${item.name}ã‚’ä½¿ç”¨ï¼ ${item.elem}å±æ€§ã® ${d} ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`;
            break;
        case "auto_weak":
            for (let s in ELEMENTS) if (ELEMENTS[s] === eelem) pelem = s;
            msg = `è™¹ã®è¼ããŒæ•µã®å¼±ç‚¹ã‚’çªãï¼å±æ€§ãŒ ${pelem} ã«å¤‰åŒ–ï¼`;
            break;
        case "field":
            fieldEffect = item.elem; fieldTimer = 3;
            msg = `${item.name}ã«ã‚ˆã‚Šã€${item.elem}å±æ€§ãŒå¼·åŒ–ã•ã‚Œã‚‹ç’°å¢ƒã«ãªã£ãŸï¼`;
            break;
        case "inst_death":
            if (Math.random() < item.rate) { ehp = 0; msg = "æ¯’é‡ãŒæ€¥æ‰€ã«çš„ä¸­ï¼æ•µã¯åŠ›å°½ããŸï¼"; }
            else { msg = "ã—ã‹ã—ã€åŠ¹æœãŒãªã‹ã£ãŸâ€¦"; }
            break;
        case "gamble":
            if (Math.random() < 0.5) { ehp = Math.floor(ehp / 2); msg = "æˆåŠŸï¼æ•µã®HPã‚’åŠåˆ†ã«ã—ãŸï¼"; }
            else { php = Math.floor(php / 2); msg = "å¤±æ•—ï¼è‡ªåˆ†ã®HPãŒåŠåˆ†ã«ãªã£ãŸï¼"; }
            break;
        case "paint":
            const others = ["ğŸ”¥", "ğŸ’§", "âš¡", "ğŸŒ¿"].filter(e => e !== eelem);
            eelem = others[Math.floor(Math.random() * others.length)];
            msg = `ãƒšãƒ³ã‚­ã‚’ã¶ã£ã‹ã‘ãŸï¼æ•µãŒ ${eelem} å±æ€§ã«æŸ“ã¾ã£ãŸï¼`;
            break;
        case "atk_focus":
            patk += pdef; pdef = 0; msg = "å®ˆã‚Šã‚’æ¨ã¦ã€å…¨åŠ›ã‚’æ”»æ’ƒã«è»¢æ›ã—ãŸï¼";
            break;
        case "def_focus":
            pdef += patk; patk = 0; msg = "æ”»ã‚ã‚’æ¨ã¦ã€å…¨åŠ›ã‚’é˜²å¾¡ã«è»¢æ›ã—ãŸï¼";
            break;
        case "trap":
            trapTimer = 3; msg = "ç½ ã‚’ä»•æ›ã‘ãŸï¼æ•µã®å‹•ãã‚’å°ã˜ã‚‹ãƒãƒ£ãƒ³ã‚¹ï¼";
            break;
        case "stone":
            if (Math.random() < 0.01) { ehp = 0; msg = "çŸ³ãŒå¥‡è·¡çš„ã«æ€¥æ‰€ã«çš„ä¸­ï¼æ•µã¯å³æ­»ã—ãŸï¼"; }
            else { ehp -= 10; msg = "çŸ³ã‚’æŠ•ã’ãŸã€‚10ãƒ€ãƒ¡ãƒ¼ã‚¸ã€‚"; }
            break;
        case "bible":
            php = pmax; ehp = 1; msg = "è–ãªã‚‹å…‰ãŒã‚ãªãŸã‚’ç™’ã‚„ã—ã€æ•µã‚’ç„¡åŠ›åŒ–ã—ãŸï¼";
            break;
        case "none":
            msg = `${item.name}ã‚’æ²ã’ãŸãŒã€ä½•ã‚‚èµ·ããªã‹ã£ãŸï¼`;
            break;
        case "escape":
            msg = "ç…™ç‰ã‚’æŠ•ã’ãŸï¼";
            setTimeout(showScan, 1000); return;
        default:
            msg = `${item.name}ã‚’ä½¿ã£ãŸãŒã€ã¾ã å®Ÿè£…ã•ã‚Œã¦ã„ãªã„ï¼`;
    }

    // UIæ›´æ–°ã¨ã‚¿ãƒ¼ãƒ³ç§»è¡Œ
    document.getElementById('msg').innerText = msg;
    inventory.splice(index, 1);
    updateUI();
    if (ehp <= 0) setTimeout(showBonus, 1200);
    else setTimeout(enemyTurn, 1200);
}
