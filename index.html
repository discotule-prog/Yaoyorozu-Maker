<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI物体鑑定バトル - スキャナー</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background: #222; color: white; margin: 0; overflow-x: hidden; }
        #video-container { position: relative; width: 100%; max-width: 400px; margin: auto; border: 4px solid #00ff00; }
        video { width: 100%; display: block; }
        #status-card { background: #333; margin: 20px; padding: 20px; border-radius: 15px; border: 2px solid #555; }
        .stat-val { font-size: 1.5em; font-weight: bold; color: #00ff00; }
        button { padding: 15px 30px; font-size: 1.2em; cursor: pointer; background: #008cba; color: white; border: none; border-radius: 5px; margin-top: 10px; }
        #loading { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.5em; }
    </style>
</head>
<body>

    <h1>AI鑑定スキャナー</h1>
    <div id="loading">AIモデル読み込み中...</div>

    <div id="video-container">
        <video id="webcam" autoplay playsinline muted></video>
    </div>

    <button id="scan-btn">スキャン開始！</button>

    <div id="status-card">
        <h2 id="obj-name">何かが映るのを待っています...</h2>
        <div id="stats" style="display: none;">
            <p>HP: <span id="hp" class="stat-val">-</span></p>
            <p>攻撃力: <span id="atk" class="stat-val">-</span></p>
            <p>防御力: <span id="def" class="stat-val">-</span></p>
        </div>
    </div>

    <script>
        let net;
        const videoElement = document.getElementById('webcam');
        const scanBtn = document.getElementById('scan-btn');

        // AIモデルの読み込みとカメラのセットアップ
        async function setup() {
            net = await mobilenet.load();
            document.getElementById('loading').style.display = 'none';

            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: "environment" }, // 背面カメラを使用
                audio: false 
            });
            videoElement.srcObject = stream;
        }

        // 文字列からステータス数値を生成するロジック
        function generateStats(name) {
            let seed = 0;
            for (let i = 0; i < name.length; i++) {
                seed += name.charCodeAt(i);
            }
            // 擬似乱数で数値を決定（同じ名前なら同じ数値になる）
            const hp = (seed % 500) + 500;
            const atk = (seed * 7 % 100) + 50;
            const def = (seed * 3 % 100) + 30;
            return { hp, atk, def };
        }

        scanBtn.addEventListener('click', async () => {
            const result = await net.classify(videoElement);
            if (result.length > 0) {
                const name = result[0].className.split(',')[0];
                const stats = generateStats(name);

                document.getElementById('obj-name').innerText = "判定： " + name;
                document.getElementById('hp').innerText = stats.hp;
                document.getElementById('atk').innerText = stats.atk;
                document.getElementById('def').innerText = stats.def;
                document.getElementById('stats').style.display = 'block';
            }
        });

        setup();
    </script>
</body>
</html>
