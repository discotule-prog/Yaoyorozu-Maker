<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SCANNER 100 FIXED</title>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
<link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
<style>
:root { --p-color: #00f2ff; --e-color: #ff3c00; }
body {
font-family: 'DotGothic16', sans-serif; background: #000; color: #fff;
margin: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column;
}
.area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; border-bottom: 2px solid #333; }

/* ãƒ¦ãƒ‹ãƒƒãƒˆè¡¨ç¤ºæ  */
.frame {
width: 140px; height: 140px; border: 3px solid #fff;
background: #111; position: relative; overflow: hidden;
box-shadow: inset 0 0 20px rgba(255,255,255,0.2);
}

/* èƒŒé¢ã®ã‚«ãƒ¡ãƒ©æ˜ åƒ */
video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.5; z-index: 1; }

/* å‰é¢ã®ã‚¤ãƒ©ã‚¹ãƒˆï¼ˆã“ã“ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¹ãå ´æ‰€ï¼‰ */
.visual-overlay {
position: absolute; top: 0; left: 0; width: 100%; height: 100%;
display: flex; align-items: center; justify-content: center;
font-size: 5rem; z-index: 2; /* ãƒ“ãƒ‡ã‚ªã‚ˆã‚Šä¸Šã«é…ç½® */
transform: scale(0); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
pointer-events: none;
}
/* ã‚¹ã‚­ãƒ£ãƒ³å¾Œã«ã“ã®ã‚¯ãƒ©ã‚¹ã‚’ä»˜ä¸ */
.is-active .visual-overlay { transform: scale(1); }

.label { position: absolute; top: 5px; left: 5px; font-size: 0.7rem; color: #888; z-index: 3; }
.name-tag { font-size: 0.85rem; margin: 5px 0; z-index: 3; }
.hp-cont { width: 80%; height: 8px; background: #333; border: 1px solid #fff; z-index: 3; }
.hp-fill { height: 100%; transition: width 0.3s; }

#ui { height: 120px; background: #111; padding: 10px; border-top: 3px solid #fff; display: flex; flex-direction: column; z-index: 10; }
#msg { flex: 1; font-size: 0.8rem; color: #0f0; }
.btns { display: flex; gap: 10px; height: 50px; }
button { flex: 1; font-family: 'DotGothic16'; border: 3px solid #fff; color: #fff; font-size: 1rem; cursor: pointer; }
#scan-btn { background: #0044cc; }
#atk-btn { background: #aa0000; }
button:disabled { opacity: 0.2; cursor: default; }

.shake { animation: s 0.2s infinite; }
@keyframes s { 0% { transform:translate(3px,3px) } 50% { transform:translate(-3px,-3px) } 100% { transform:translate(0,0) } }
</style>
</head>
<body>

<div class="area" id="p-area">
<div class="label">PLAYER WEAPON</div>
<div class="frame" id="pf">
<video id="pv" autoplay playsinline muted></video>
<div id="pw-icon" class="visual-overlay">âš”ï¸</div>
</div>
<div class="name-tag"><span id="pn">SCAN OBJECT</span> <span id="p-id" style="color:var(--p-color)"></span></div>
<div class="hp-cont"><div id="phf" class="hp-fill" style="background:var(--p-color); width:100%"></div></div>
</div>

<div class="area" id="e-area">
<div class="label">ENEMY MONSTER</div>
<div class="frame" id="ef">
<video id="ev" autoplay playsinline muted></video>
<div id="em-icon" class="visual-overlay">ğŸ‘¾</div>
</div>
<div class="name-tag"><span id="en">SCAN TARGET</span> <span id="e-id" style="color:var(--e-color)"></span></div>
<div class="hp-cont"><div id="ehf" class="hp-fill" style="background:var(--e-color); width:100%"></div></div>
</div>

<div id="ui">
<div id="msg">1. WEAPON ã‚¹ã‚­ãƒ£ãƒ³ã‚’é–‹å§‹ã—ã¦ãã ã•ã„</div>
<div class="btns">
<button id="scan-btn">SCAN</button>
<button id="atk-btn" disabled>ATTACK!</button>
</div>
</div>

<script>
let net, mode = "W", php=1000, ehp=1000, patk=100, eatk=120;

// æ­¦å™¨(100)ã¨ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼(100)ã®ãƒªã‚¹ãƒˆã‚’ã—ã£ã‹ã‚Šå®šç¾©
const weapons = ["âš”ï¸","ğŸ—¡ï¸","ğŸ”«","ğŸ¹","ğŸ”¨","ğŸª“","ğŸª„","ğŸ§ª","ğŸ›¡ï¸","ğŸ”±","ğŸ¸","ğŸ§¹","ğŸ¥¢","ğŸªƒ","â›“ï¸","ğŸ›¸","ğŸ§¤","ğŸ’","ğŸ””","ğŸ•¯ï¸","ğŸ”¨","â›ï¸","âš’ï¸","ğŸ§±","ğŸ¹","ğŸ’£","ğŸ§¨","ğŸªš","ğŸ”©","âš™ï¸","âš–ï¸","â›“ï¸","ğŸ’","âš—ï¸","ğŸ”­","ğŸ’ˆ","ğŸ”¦","ğŸ®","ğŸ“œ","ğŸ”‘"];
const monsters = ["ğŸ‘¾","ğŸ‘¹","ğŸº","ğŸ‰","ğŸ§Ÿ","ğŸ§›","ğŸ","ğŸ•·ï¸","ğŸ™","ğŸ¦‚","ğŸŒµ","ğŸ‘»","ğŸ¤–","ğŸ¦","ğŸ¯","ğŸ»","ğŸ¦…","ğŸ¦ˆ","ğŸ¦–","ğŸŒ‹","ğŸ‘º","ğŸ’€","ğŸ‘½","ğŸ¦ ","ğŸ¦‚","ğŸ¦Ÿ","ğŸ¦—","ğŸœ","ğŸ","ğŸ","ğŸ¦‹","ğŸš","ğŸŒ","ğŸ¢","ğŸ","ğŸ¦","ğŸ…","ğŸ†","ğŸ˜"];

async function init() {
try {
net = await mobilenet.load();
const s = await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
document.getElementById('pv').srcObject = s;
document.getElementById('ev').srcObject = s;
document.getElementById('msg').innerText = "READY. WEAPONã‚’ã‚¹ã‚­ãƒ£ãƒ³ï¼";
} catch(e) {
document.getElementById('msg').innerText = "CAMERA ERROR: " + e;
}
}

function getID(name) {
let sum = 0;
for (let i = 0; i < name.length; i++) sum += name.charCodeAt(i);
return sum % 100;
}

document.getElementById('scan-btn').onclick = async () => {
const video = document.getElementById('pv');
const r = await net.classify(video);
const name = r[0].className.split(',')[0].toUpperCase();
const id = getID(name);

if (mode === "W") {
document.getElementById('pn').innerText = name;
document.getElementById('p-id').innerText = "#" + id.toString().padStart(2, '0');
// ã‚¤ãƒ©ã‚¹ãƒˆã‚’ã‚»ãƒƒãƒˆã—ã¦è¡¨ç¤º
const icon = weapons[id % weapons.length];
document.getElementById('pw-icon').innerText = icon;
document.getElementById('pf').classList.add('is-active');

patk = 100 + id;
document.getElementById('msg').innerText = "WEAPONç¢ºèªï¼æ¬¡ã¯ENEMYã‚’ã‚¹ã‚­ãƒ£ãƒ³ï¼";
mode = "M";
} else if (mode === "M") {
document.getElementById('en').innerText = name;
document.getElementById('e-id').innerText = "#" + id.toString().padStart(2, '0');
// ã‚¤ãƒ©ã‚¹ãƒˆã‚’ã‚»ãƒƒãƒˆã—ã¦è¡¨ç¤º
const icon = monsters[id % monsters.length];
document.getElementById('em-icon').innerText = icon;
document.getElementById('ef').classList.add('is-active');

eatk = 120 + id;
document.getElementById('msg').innerText = "ENEMYç¢ºèªï¼ãƒãƒˆãƒ«é–‹å§‹ï¼";
document.getElementById('atk-btn').disabled = false;
document.getElementById('scan-btn').disabled = true;
mode = "B";
}
};

document.getElementById('atk-btn').onclick = () => {
// ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—ã¨æ¼”å‡º
document.getElementById('ef').classList.add('shake');
let d = patk + Math.floor(Math.random() * 50);
ehp -= d;

setTimeout(() => {
document.getElementById('ef').classList.remove('shake');
if(ehp > 0) {
document.getElementById('pf').classList.add('shake');
let ed = eatk + Math.floor(Math.random() * 50);
php -= ed;
update();
setTimeout(() => document.getElementById('pf').classList.remove('shake'), 200);
}
if(php <= 0 || ehp <= 0) {
document.getElementById('msg').innerText = php > 0 ? "VICTORY! ç›®æ¨™ã‚’å®Œå…¨ç ´å£Šã€‚" : "DEFEAT... ã‚·ã‚¹ãƒ†ãƒ å¤§ç ´ã€‚";
document.getElementById('atk-btn').disabled = true;
}
}, 400);
update();
};

function update() {
document.getElementById('phf').style.width = Math.max(0, (php/1000)*100) + "%";
document.getElementById('ehf').style.width = Math.max(0, (ehp/1000)*100) + "%";
}

init();
</script>
</body>
</html>
