<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Scanner RPG - Full Item Integration</title>
    <style>
        /* æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¶­æŒ */
        body { background: #111; color: #0f0; font-family: monospace; text-align: center; }
        #game-container { max-width: 400px; margin: auto; border: 2px solid #0f0; padding: 10px; }
        .screen { display: none; }
        .btn { border: 1px solid #0f0; padding: 10px; margin: 5px; cursor: pointer; display: inline-block; width: 80%; }
        .btn:active { background: #050; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 10px; text-align: left; }
        #inventory-list { text-align: left; height: 200px; overflow-y: auto; border: 1px solid #050; padding: 5px; }
        .rare-NORMAL { color: #fff; }
        .rare-ELITE { color: #f0f; font-weight: bold; }
        .rare-LEGEND { color: #ff0; font-weight: bold; text-shadow: 0 0 5px #fff; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="msg" style="height: 60px; margin-bottom: 10px;"></div>

    <div id="scan-screen" class="screen" style="display: block;">
        <div class="btn" onclick="scanItem()">ã‚¢ã‚¤ãƒ†ãƒ ã‚’ã‚¹ã‚­ãƒ£ãƒ³</div>
        <div class="btn" onclick="showScreen('battle-screen'); startBattle();">æˆ¦é—˜é–‹å§‹</div>
        <div class="btn" onclick="showInventory()">æŒã¡ç‰©</div>
    </div>

    <div id="battle-screen" class="screen">
        <div class="stat-grid">
            <div>PLAYER HP: <span id="p-hp"></span></div>
            <div>ENEMY HP: <span id="e-hp"></span></div>
            <div>ATK: <span id="p-atk"></span> | DEF: <span id="p-def"></span></div>
            <div>Elem: <span id="p-elem"></span> vs <span id="e-elem"></span></div>
        </div>
        <div id="battle-btns">
            <div class="btn" onclick="playerAttack()">æ”»æ’ƒ</div>
            <div class="btn" onclick="openItemOverlay()">ã‚¢ã‚¤ãƒ†ãƒ </div>
        </div>
    </div>

    <div id="item-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); padding-top:20px;">
        <h3>ä½¿ç”¨ã™ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã‚’é¸æŠ</h3>
        <div id="inventory-list"></div>
        <div class="btn" onclick="document.getElementById('item-overlay').style.display='none'">æˆ»ã‚‹</div>
    </div>
</div>

<script>
// --- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ---
const ELEMENTS = {"ğŸ”¥":"ğŸŒ¿", "ğŸŒ¿":"âš¡", "âš¡":"ğŸ’§", "ğŸ’§":"ğŸ”¥"};
const DB_ITEM = [
    "éå¸¸é£Ÿ", "ãƒ‘ãƒ³", "ç¼¶è©°", "æ–°é®®é‡èœ", "æ—¬ of é‡èœ", "æœå®Ÿ", "é«˜ç´šæœå®Ÿ", "éª¨ä»˜ãè‚‰", "éª¨ä»˜ãè‚‰ï¼ˆå¤§ï¼‰", "æºå¸¯ãƒ•ãƒ«ã‚³ãƒ¼ã‚¹", 
    "è»Ÿè†", "ã‚¨ãƒŠã‚¸ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯", "æ „é¤Šãƒ‰ãƒªãƒ³ã‚¯", "å‚·è–¬", "é«˜ç´šå‚·è–¬", "ãƒãƒ¼ã‚·ãƒ§ãƒ³", "ãƒã‚¤ãƒãƒ¼ã‚·ãƒ§ãƒ³", "ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚·ãƒ§ãƒ³", "è–æ°´", "ç¥æ§˜ã®é›«", 
    "æ¾æ˜", "æ°´é¢¨èˆ¹", "å£Šã‚ŒãŸæ©Ÿæ¢°", "è”¦", 
    "ç«ç‚ç“¶", "æ°´é‰„ç ²", "ãƒ“ãƒªãƒ“ãƒªãƒã‚·ãƒ³", "èŠ", 
    "æ‰‹æ¦´å¼¾", "æ”¾æ°´ãƒ›ãƒ¼ã‚¹", "é›»æ°—ã‚·ãƒ§ãƒƒã‚¯", "æœ‰æ¯’æ¤ç‰©", 
    "ç«ç‚æ”¾å°„å™¨", "é«˜åœ§æ´—æµ„æ©Ÿ", "ã‚¹ã‚¿ãƒ³ã‚¬ãƒ³", "é£Ÿè™«æ¤ç‰©", 
    "çˆ†å¼¾", "ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ã‚«ãƒƒã‚¿ãƒ¼", "ã‚¨ãƒ¬ã‚­ãƒ†ãƒ«", "å¾¡ç¥æœ¨ã®æ", 
    "é¢¨é‚ªã‚¦ã‚¤ãƒ«ã‚¹", "ã‚µãƒ³ãƒ—ãƒ«ç—…åŸèŒ", "äººå·¥ã‚¦ã‚¤ãƒ«ã‚¹", "ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶", "æœªçŸ¥ã®ã‚¦ã‚¤ãƒ«ã‚¹", 
    "ã‚ªãƒ«ã‚´ãƒ¼ãƒ«", "å®‰çœ æ•", "ã‚„ã‚‹æ°—ã‚ªãƒ•ã‚¹ã‚¤ãƒƒãƒ", "ä¸–ç•Œèª¬æ•™ãƒ†ãƒ¼ãƒ—", "èƒ¸ç³æ˜ åƒ", 
    "æ¤ç‰©ç³»ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³", "å‹•ç‰©ç³»ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³", "ç­‹è‚‰å¢—å¼·å‰¤", "ç­‹è‚‰å¢—å¼·å‰¤", "åˆæ³•ãƒ‰ãƒ©ãƒƒã‚°", 
    "æ¤ç‰©ç³»ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³", "å‹•ç‰©ç³»ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³", "ç­‹è‚‰å¢—å¼·å‰¤", "ç­‹è‚‰å¢—å¼·å‰¤", "åˆæ³•ãƒ‰ãƒ©ãƒƒã‚°", 
    "ç…™ç‰", "å¹¸é‹ã®ç£çŸ³", "ä¸æ€è­°ãªç ‚æ™‚è¨ˆ", "ã‚¾ãƒ¼ãƒ³ã®å¿ƒå¾—", "ãƒœã‚¯ã‚µãƒ¼ã‚·ãƒ¥ãƒ¼ã‚º", 
    "èµ¤ã„ãƒãƒ³ãƒˆ", "é’ã„è…•è¼ª", "é»„è‰²ã®ãƒ”ã‚¢ã‚¹", "ç·‘ of æŒ‡è¼ª", "è™¹ã®ã‹ã‘ã‚‰", 
    "ç™ºç«ç‡ƒæ–™", "é›¨é›²ç™ºç”Ÿæ©Ÿ", "ç£å ´ç™ºç”Ÿè£…ç½®", "è¶…æˆé•·ä¿ƒé€²å‰¤", 
    "æ¯’é‡", "ã‚®ãƒ£ãƒ³ãƒ–ãƒ«ã®ã‚µã‚¤ã‚³ãƒ­", "ãƒšãƒ³ã‚­", "è¦šæ‚Ÿã®ã‚¹ã‚¹ãƒ¡", "äº€ã®ç”²ç¾…", "ç½ ", 
    "å¤ã³ãŸãƒ©ãƒ³ãƒ—", "ä½•ã‹ã®ç¥æ§˜ã®åƒ", "èª°ã‹ã®æ—¥è¨˜", "æµ·è³Šã®éŠ€è²¨", "æ›¸ã‘ãªã„ä¸‡å¹´ç­†", 
    "æ±æ´‹ã®æ°´å¢¨ç”»", "è£¸ã®ç‹æ§˜ã®æœ", "ç›¸å¯¾æ€§ç†è«–åŸæœ¬", "é™ã‚ŠãªãçœŸå††ã«è¿‘ã„çŸ³", "å††å‘¨ç‡æœ€å¾Œã®æ•°å­—", 
    "èª°ã‚‚çŸ¥ã‚‰ãªã„ç‰©èª", "æ¼¢ã®æµªæ¼«", "å¤ä»£ã®ãƒ‡ã‚¸ã‚¿ãƒ«æ™‚è¨ˆ", "å½å…¸", "ã‚µãƒ³ã‚¿ã®é«­", 
    "ã‚µãƒ³ã‚¿ã®é«­ï¼ˆæœ¬ç‰©ï¼‰", "å¤©ä½¿ã®è¼ªã£ã‹", "ç«œã®ãƒ•ãƒ³", "çŸ³", "è–æ›¸" 
];

// --- ã‚²ãƒ¼ãƒ çŠ¶æ…‹ ---
let php = 1000, pMax = 1000, patk = 50, pdef = 30, pelem = "ğŸ”¥";
let ehp = 500, eMax = 500, eatk = 40, edef = 20, eelem = "ğŸŒ¿";
let inventory = [];
let expMultiplier = 1, isPerfectHit = false, isPerfectDodge = false;
let fieldElem = null, fieldTurns = 0;

// --- ãƒ¬ã‚¢åº¦åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ ---
function getRare(gid) {
    if ( (gid >= 205 && gid <= 209) || (gid >= 215 && gid <= 217) || (gid >= 232 && gid <= 235) || 
         gid === 243 || gid === 248 || gid === 253 || gid === 258 || (gid >= 265 && gid <= 268) ||
         (gid >= 270 && gid <= 273) || gid === 275 || gid === 277 || gid === 278 ) return "ELITE";
    
    if ( (gid >= 218 && gid <= 219) || (gid >= 236 && gid <= 239) || gid === 244 || gid === 249 || 
         gid === 254 || gid === 259 || gid === 261 || gid === 262 || gid === 269 || 
         (gid >= 280 && gid <= 297) || gid === 299 ) return "LEGEND";
    
    return "NORMAL";
}

// --- ã‚¢ã‚¤ãƒ†ãƒ ä½¿ç”¨å‡¦ç† ---
function useItem(invIdx) {
    let itemId = inventory[invIdx];
    let gid = 200 + itemId;
    let itemName = DB_ITEM[itemId];
    let msg = "";

    // 1. å›å¾© (200-219)
    if (gid <= 209) {
        let val = (gid - 199) * 100;
        php = Math.min(pMax, php + val);
        msg = `${itemName}ã§ HPãŒ${val}å›å¾©ï¼`;
    } else if (gid <= 218) {
        let rate = (gid - 209) * 0.1;
        let val = Math.floor(pMax * rate);
        php = Math.min(pMax, php + val);
        msg = `${itemName}ã§ HPãŒ${Math.round(rate*100)}%å›å¾©ï¼`;
    } else if (gid === 219) {
        php = pMax; msg = `${itemName}ã§å…¨å›å¾©ï¼`;
    }
    // 2. å±æ€§æ”»æ’ƒ (220-239)
    else if (gid <= 239) {
        const elems = ["ğŸ”¥", "ğŸ’§", "âš¡", "ğŸŒ¿"];
        let e = elems[(gid - 220) % 4];
        let lv = Math.floor((gid - 220) / 4) + 1;
        let base = [30, 100, 250, 500, 1000][lv-1];
        let dmg = Math.floor(base * (patk/10));
        if(ELEMENTS[e] === eelem) dmg *= 2;
        ehp = Math.max(0, ehp - dmg);
        msg = `${itemName}ï¼ ${e}ã®${dmg}ãƒ€ãƒ¡ï¼`;
    }
    // 3. ãƒ‡ãƒãƒ•ãƒ»ãƒãƒ• (240-259)
    else if (gid <= 244) { 
        let r = [0.1, 0.2, 0.3, 0.5, 0.75][gid-240]; 
        edef = Math.floor(edef*(1-r)); msg = `${itemName}ï¼ æ•µé˜²å¾¡${r*100}%æ¸›ï¼`; 
    }
    else if (gid <= 249) { 
        let r = [0.1, 0.2, 0.3, 0.5, 0.75][gid-245]; 
        eatk = Math.floor(eatk*(1-r)); msg = `${itemName}ï¼ æ•µæ”»æ’ƒ${r*100}%æ¸›ï¼`; 
    }
    else if (gid <= 254) { 
        let r = [0.1, 0.2, 0.3, 0.5, 0.75][gid-250]; 
        patk = Math.floor(patk*(1+r)); msg = `${itemName}ï¼ æ”»æ’ƒåŠ›${r*100}%å¢—ï¼`; 
    }
    else if (gid <= 259) { 
        let r = [0.1, 0.2, 0.3, 0.5, 0.75][gid-255]; 
        pdef = Math.floor(pdef*(1+r)); msg = `${itemName}ï¼ é˜²å¾¡åŠ›${r*100}%å¢—ï¼`; 
    }
    // 4. ç‰¹æ®Š (260-269)
    else if (gid === 260) { msg = "ç…™ã«å·»ã„ã¦é€ƒã’å‡ºã—ãŸï¼"; setTimeout(()=>location.reload(), 1000); }
    else if (gid === 261) { expMultiplier = 5; msg = "ç²å¾—çµŒé¨“å€¤5å€ï¼"; }
    else if (gid === 262) { 
        msg = "ã‚‚ã†ä¸€åº¦è‡ªåˆ†ã®ã‚¿ãƒ¼ãƒ³ï¼"; inventory.splice(invIdx, 1);
        document.getElementById('msg').innerText = msg; updateUI(); 
        document.getElementById('item-overlay').style.display='none'; return; 
    }
    else if (gid === 263) { isPerfectHit = true; msg = "æ¬¡ã€å¿…ä¸­ï¼"; }
    else if (gid === 264) { isPerfectDodge = true; msg = "æ¬¡ã€å®Œå…¨å›é¿ï¼"; }
    else if (gid <= 268) { pelem = ["ğŸ”¥", "ğŸ’§", "âš¡", "ğŸŒ¿"][gid-265]; msg = `å±æ€§ãŒ ${pelem} ã«ï¼`; }
    else if (gid === 269) { for(let k in ELEMENTS) if(ELEMENTS[k]===eelem) pelem=k; msg = `å¼±ç‚¹å±æ€§ ${pelem} ã«å¤‰åŒ–ï¼`; }
    // 5. æœ€çµ‚ (270-299)
    else if (gid <= 273) { fieldElem = ["ğŸ”¥", "ğŸ’§", "âš¡", "ğŸŒ¿"][gid-270]; fieldTurns=3; msg = `ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒ ${fieldElem} ã«ï¼`; }
    else if (gid === 277) { patk += pdef; pdef = 0; msg = "æ”»æ’ƒç‰¹åŒ–ï¼"; }
    else if (gid === 278) { pdef += patk; patk = 0; msg = "é˜²å¾¡ç‰¹åŒ–ï¼"; }
    else if (gid === 298) { let d = Math.random()<0.01?ehp:10; ehp-=d; msg = `${d}ãƒ€ãƒ¡ï¼`; }
    else if (gid === 299) { php = pMax; ehp = 1; msg = "è–ãªã‚‹å¥‡è·¡ï¼"; }
    else { msg = `${itemName}ã‚’çœºã‚ãŸã€‚`; }

    document.getElementById('msg').innerText = msg;
    inventory.splice(invIdx, 1);
    document.getElementById('item-overlay').style.display = 'none';
    updateUI();
    setTimeout(enemyTurn, 1000);
}

// --- ä»¥ä¸‹ã€ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ---
function updateUI() {
    document.getElementById('p-hp').innerText = php;
    document.getElementById('e-hp').innerText = ehp;
    document.getElementById('p-atk').innerText = patk;
    document.getElementById('p-def').innerText = pdef;
    document.getElementById('p-elem').innerText = pelem;
    document.getElementById('e-elem').innerText = eelem;
}

function openItemOverlay() {
    const list = document.getElementById('inventory-list');
    list.innerHTML = "";
    inventory.forEach((itemId, idx) => {
        let gid = 200 + itemId;
        let rare = getRare(gid);
        let d = document.createElement('div');
        d.className = `btn rare-${rare}`;
        d.innerText = `[${rare}] ${DB_ITEM[itemId]}`;
        d.onclick = () => useItem(idx);
        list.appendChild(d);
    });
    document.getElementById('item-overlay').style.display = 'block';
}

function scanItem() {
    let id = Math.floor(Math.random() * DB_ITEM.length);
    inventory.push(id);
    document.getElementById('msg').innerText = `${DB_ITEM[id]} ã‚’å…¥æ‰‹ã—ãŸï¼`;
}

function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
    document.getElementById(id).style.display = 'block';
}

function startBattle() {
    ehp = eMax; updateUI();
    document.getElementById('msg').innerText = "æˆ¦é—˜é–‹å§‹ï¼";
}

function playerAttack() {
    let dmg = Math.max(1, patk - edef);
    ehp = Math.max(0, ehp - dmg);
    document.getElementById('msg').innerText = `ã‚ãªãŸã®æ”»æ’ƒï¼ ${dmg}ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`;
    updateUI();
    if(ehp <= 0) { document.getElementById('msg').innerText = "å‹åˆ©ï¼"; setTimeout(()=>location.reload(), 2000); }
    else { setTimeout(enemyTurn, 1000); }
}

function enemyTurn() {
    if (isPerfectDodge) { 
        document.getElementById('msg').innerText = "æ•µã®æ”»æ’ƒã‚’å›é¿ï¼"; 
        isPerfectDodge = false; return; 
    }
    let dmg = Math.max(1, eatk - pdef);
    php = Math.max(0, php - dmg);
    document.getElementById('msg').innerText = `æ•µã®æ”»æ’ƒï¼ ${dmg}ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`;
    updateUI();
}
</script>
</body>
</html>
