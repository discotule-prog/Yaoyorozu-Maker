<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>AI Scan Adventure - Full System</title>
    <style>
        body { background: #111; color: #eee; font-family: sans-serif; text-align: center; margin: 0; }
        #game-container { max-width: 500px; margin: auto; padding: 20px; border: 2px solid #333; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-box { background: #222; padding: 10px; border-radius: 5px; border: 1px solid #444; }
        #msg { height: 80px; background: #000; padding: 10px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; border: 1px inset #333; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { padding: 15px; font-weight: bold; cursor: pointer; background: #444; color: white; border: none; border-radius: 5px; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .item-btn { background: #2c3e50; }
        .attack-btn { background: #c0392b; }
        .legend { color: #ffd700; text-shadow: 0 0 5px #aa8800; }
        .elite { color: #00f2ff; text-shadow: 0 0 5px #0088ff; }
    </style>
</head>
<body>

<div id="game-container">
    <h2>AI Scan Adventure</h2>
    
    <div class="stat-grid">
        <div class="stat-box">
            <div>Player <span id="p-elem">ğŸ”¥</span></div>
            <div>HP: <span id="p-hp">500</span> / <span id="p-max">500</span></div>
            <div>ATK: <span id="p-atk">100</span> | DEF: <span id="p-def">50</span></div>
        </div>
        <div class="stat-box">
            <div>Enemy <span id="e-elem">ğŸŒ¿</span></div>
            <div>HP: <span id="e-hp">---</span></div>
            <div id="e-name">ã‚¹ã‚­ãƒ£ãƒ³å¾…æ©Ÿä¸­</div>
        </div>
    </div>

    <div id="msg">ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ãƒãƒˆãƒ«é–‹å§‹ï¼</div>

    <div id="actions" class="btn-grid">
        <button onclick="startBattleScan()" id="btn-scan">ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’ã‚¹ã‚­ãƒ£ãƒ³</button>
        <button onclick="openInventory()" id="btn-item" disabled>ã‚¢ã‚¤ãƒ†ãƒ </button>
        <button onclick="playerAttack()" id="btn-attack" disabled>æ”»æ’ƒ</button>
        <button onclick="weaponScan()" id="btn-weapon" disabled>æ­¦å™¨ã‚¹ã‚­ãƒ£ãƒ³</button>
    </div>

    <div id="inventory-list" style="display:none; margin-top:20px; border-top:1px solid #444; padding-top:10px;">
        <h3>æ‰€æŒã‚¢ã‚¤ãƒ†ãƒ </h3>
        <div id="items-container"></div>
        <button onclick="closeInventory()" style="margin-top:10px; background:#666;">æˆ»ã‚‹</button>
    </div>
</div>

<script>
// ==========================================
// 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
// ==========================================

// ã‚¢ã‚¤ãƒ†ãƒ DB (No.200 - 299)
const DB_ITEM = {
    // å›å¾© (200-219)
    200: { name: "éå¸¸é£Ÿ", rare: "NORMAL", type: "heal_fix", val: 50 },
    210: { name: "ãƒãƒ¼ã‚·ãƒ§ãƒ³", rare: "ELITE", type: "heal_fix", val: 600 },
    216: { name: "ã‚¨ãƒªã‚¯ã‚µãƒ¼", rare: "LEGEND", type: "heal_per", val: 1.0 },
    219: { name: "ç¥æ§˜ã®é›«", rare: "LEGEND", type: "heal_per", val: 1.0 },
    // æ”»æ’ƒ (220-239)
    220: { name: "ç«ã®ç²‰", rare: "NORMAL", type: "dmg", elem: "ğŸ”¥", val: 50 },
    224: { name: "å¤ªé™½ã®è¼ã", rare: "LEGEND", type: "dmg", elem: "ğŸ”¥", val: 1200 },
    234: { name: "ç¥ã®è£ã", rare: "LEGEND", type: "dmg", elem: "âš¡", val: 1200 },
    // ç‰¹æ®Š (260-279)
    260: { name: "ç…™ç‰", rare: "NORMAL", type: "escape" },
    265: { name: "ä¸æ€è­°ãªç ‚æ™‚è¨ˆ", rare: "LEGEND", type: "extra_turn" },
    269: { name: "è™¹ã®ã‹ã‘ã‚‰", rare: "LEGEND", type: "auto_weak" },
    270: { name: "ç™ºç«ç‡ƒæ–™", rare: "ELITE", type: "field", elem: "ğŸ”¥" },
    274: { name: "æ¯’é‡", rare: "NORMAL", type: "inst_death", rate: 0.1 },
    275: { name: "ã‚®ãƒ£ãƒ³ãƒ–ãƒ«ã®ã‚µã‚¤ã‚³ãƒ­", rare: "ELITE", type: "gamble" },
    276: { name: "ãƒšãƒ³ã‚­", rare: "NORMAL", type: "paint" },
    277: { name: "è¦šæ‚Ÿã®ã‚¹ã‚¹ãƒ¡", rare: "ELITE", type: "atk_focus" },
    278: { name: "äº€ã®ç”²ç¾…", rare: "ELITE", type: "def_focus" },
    279: { name: "ç½ ", rare: "NORMAL", type: "trap" },
    // ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ (280-297)
    280: { name: "å¤ã³ãŸãƒ©ãƒ³ãƒ—", rare: "LEGEND", type: "none" },
    291: { name: "æ¼¢ã®æµªæ¼«", rare: "LEGEND", type: "none" },
    297: { name: "ç«œã®ãƒ•ãƒ³", rare: "LEGEND", type: "none" },
    // ãƒ©ã‚¹ãƒˆ
    298: { name: "çŸ³", rare: "NORMAL", type: "stone" },
    299: { name: "è–æ›¸", rare: "LEGEND", type: "bible" }
};
// â€»å®Ÿéš›ã«ã¯200-299ã®å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã“ã“ã«æµã—è¾¼ã¿ã¾ã™ã€‚

// ==========================================
// 2. ã‚²ãƒ¼ãƒ å¤‰æ•°
// ==========================================
let php = 500, pmax = 500, patk = 100, pdef = 50, pelem = "ğŸ”¥";
let ehp = 0, emax = 0, eatk = 0, eelem = "ğŸŒ¿", ename = "";
let inventory = [200, 274, 299]; // åˆæœŸã‚¢ã‚¤ãƒ†ãƒ 
let fieldEffect = null, fieldTimer = 0, trapTimer = 0;

const ELEMENTS = { "ğŸ”¥": "ğŸŒ¿", "ğŸ’§": "ğŸ”¥", "âš¡": "ğŸ’§", "ğŸŒ¿": "âš¡" };

// ==========================================
// 3. ãƒãƒˆãƒ«ãƒ»ã‚¹ã‚­ãƒ£ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
// ==========================================

function updateUI() {
    document.getElementById('p-hp').innerText = php;
    document.getElementById('p-max').innerText = pmax;
    document.getElementById('p-atk').innerText = patk;
    document.getElementById('p-def').innerText = pdef;
    document.getElementById('p-elem').innerText = pelem;
    document.getElementById('e-hp').innerText = ehp > 0 ? ehp : "---";
    document.getElementById('e-elem').innerText = eelem;
    document.getElementById('e-name').innerText = ename || "ã‚¹ã‚­ãƒ£ãƒ³å¾…æ©Ÿä¸­";
}

// ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ç”Ÿæˆï¼ˆä»®ï¼‰
function startBattleScan() {
    // æœ¬æ¥ã¯ã“ã“ã§AIã‚«ãƒ¡ãƒ©èµ·å‹•
    ename = "ã‚¹ã‚­ãƒ£ãƒ³ã•ã‚ŒãŸé‡è‰¯ã‚¹ãƒ©ã‚¤ãƒ ";
    ehp = 300; emax = 300; eatk = 40; eelem = "ğŸŒ¿";
    document.getElementById('msg').innerText = `${ename}ãŒç¾ã‚ŒãŸï¼`;
    document.getElementById('btn-scan').disabled = true;
    document.getElementById('btn-attack').disabled = false;
    document.getElementById('btn-item').disabled = false;
    document.getElementById('btn-weapon').disabled = false;
    updateUI();
}

// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ”»æ’ƒ
function playerAttack() {
    let dmg = Math.max(10, patk);
    if (ELEMENTS[pelem] === eelem) {
        dmg = Math.floor(dmg * 1.5);
        document.getElementById('msg').innerText = "åŠ¹æœã¯æŠœç¾¤ã ï¼";
    }
    ehp -= dmg;
    updateUI();
    if (ehp <= 0) {
        document.getElementById('msg').innerText += `\n${ename}ã‚’å€’ã—ãŸï¼`;
        setTimeout(winBattle, 1200);
    } else {
        setTimeout(enemyTurn, 800);
    }
}

// æ•µã®ã‚¿ãƒ¼ãƒ³
function enemyTurn() {
    if (trapTimer > 0) {
        trapTimer--;
        if (Math.random() < 0.4) {
            document.getElementById('msg').innerText = "æ•µã¯ç½ ã«ã‹ã‹ã£ã¦å‹•ã‘ãªã„ï¼";
            return;
        }
    }
    let dmg = Math.max(5, eatk - pdef);
    php -= dmg;
    document.getElementById('msg').innerText = `${ename}ã®æ”»æ’ƒï¼ ${dmg} ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`;
    updateUI();
    if (php <= 0) alert("æ•—åŒ—ã—ã¾ã—ãŸ...");
}

// ã‚¢ã‚¤ãƒ†ãƒ ä½¿ç”¨
function useItem(id, index) {
    const item = DB_ITEM[id];
    let msg = "";
    
    // ã‚¢ã‚¤ãƒ†ãƒ ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã“ã“ã‚’DBã®å†…å®¹ã«åˆã‚ã›æ‹¡å¼µï¼‰
    if (item.type === "heal_fix") { php = Math.min(pmax, php + item.val); msg = `${item.name}ã§å›å¾©ï¼`; }
    else if (item.type === "inst_death") { 
        if(Math.random() < item.rate) { ehp = 0; msg = "æ¯’é‡ãŒæ€¥æ‰€ã«çš„ä¸­ï¼"; } else { msg = "åŠ¹æœãŒãªã‹ã£ãŸ..."; }
    }
    else if (item.type === "bible") { php = pmax; ehp = 1; msg = "è–æ›¸ã®å¥‡è·¡ï¼"; }
    else if (item.type === "none") { msg = "ã—ã‹ã—ã€ä½•ã‚‚èµ·ããªã‹ã£ãŸï¼"; }
    
    document.getElementById('msg').innerText = msg;
    inventory.splice(index, 1);
    closeInventory();
    updateUI();
    if (ehp <= 0) setTimeout(winBattle, 1200);
    else setTimeout(enemyTurn, 1200);
}

// å‹åˆ©å‡¦ç† -> ã‚¢ã‚¤ãƒ†ãƒ ã‚¹ã‚­ãƒ£ãƒ³ã¸
function winBattle() {
    document.getElementById('msg').innerText = "æˆ¦é—˜å‹åˆ©ï¼ã‚¢ã‚¤ãƒ†ãƒ ã‚’ã‚¹ã‚­ãƒ£ãƒ³ä¸­...";
    // ã“ã“ã§AIã‚¹ã‚­ãƒ£ãƒ³ã‚’å®Ÿè¡Œ
    const rewards = [210, 275, 298, 299, 280]; // ãƒ©ãƒ³ãƒ€ãƒ ã«é¸å‡º
    const drop = rewards[Math.floor(Math.random() * rewards.length)];
    inventory.push(drop);
    alert(`${DB_ITEM[drop].name} ã‚’ç²å¾—ã—ãŸï¼`);
    location.reload(); // ãƒªã‚»ãƒƒãƒˆã—ã¦æ¬¡ã¸ï¼ˆä»®ï¼‰
}

// ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªç®¡ç†
function openInventory() {
    const container = document.getElementById('items-container');
    container.innerHTML = "";
    inventory.forEach((id, index) => {
        const item = DB_ITEM[id];
        const btn = document.createElement('button');
        btn.className = "item-btn " + item.rare.toLowerCase();
        btn.innerText = `[${item.rare}] ${item.name}`;
        btn.onclick = () => useItem(id, index);
        container.appendChild(btn);
    });
    document.getElementById('inventory-list').style.display = 'block';
}

function closeInventory() {
    document.getElementById('inventory-list').style.display = 'none';
}

updateUI();
</script>
</body>
</html>
